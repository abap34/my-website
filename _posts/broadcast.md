---
title: "Juliaã§ A .+ Bã‚’ã—ãŸæ™‚ã€ä½•ãŒèµ·ãã¦ã„ã‚‹ã®ã‹"
emoji: "ğŸ¤®"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["julia"]
published: false
---

# è‡ªå·±ç´¹ä»‹

{ã“ã“ã«è‡ªå·±ç´¹ä»‹ã‚’æ›¸ã}

æ™®æ®µã¯æ©Ÿæ¢°å­¦ç¿’è«¸ã€…ã‚’å‹‰å¼·ã—ã¦ã„ã¦ã€https://github.com/abap34/DeepShiba.jl ã‚’ä½œã£ãŸã‚Šã—ã¦ã„ã¾ã™ã€‚(æœ€è¿‘ã¯ã‚ã¾ã‚Šæ‰‹ãŒå›ã£ã¦ã„ãªã„ã§ã™ãŒ...)

ã“ã®éç¨‹ã§ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆå‘¨ã‚Šã‚’åˆ¶å¾¡ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ Juliaã® ~~ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚€ãƒãƒ¡ã«ãªã£ãŸ~~ ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¾ã›ã¦ã„ãŸã ãæ©Ÿä¼šã‚’ã„ãŸã ã‘ãŸã®ã§ã€è¨˜äº‹ã«ã—ã¦æ®‹ãã†ã¨æ€ã„ã¾ã™ã€‚


# ã“ã®è¨˜äº‹ã«ã¤ã„ã¦

ã‚¿ã‚¤ãƒˆãƒ«ã®é€šã‚Šã€Juliaã®å®Ÿè£…ã‚’è¿½ã†ã“ã¨ã«ã‚ˆã£ã¦ã€Juliaã§`A .+ B`ã‚’å®Ÿè¡Œã—ãŸæ™‚ã«ä½•ãŒèµ·ãã¦ã„ã‚‹ã®ã‹ã‚’è¿½ã†è¨˜äº‹ã§ã™ã€‚

ã¾ãŸã€ãã®éç¨‹ã§å¿…è¦ãªè«¸æ¦‚å¿µã«ã¤ã„ã¦ã‚‚è§£èª¬ã—ã¦ã„ãã¾ã™ã€‚

ãŸã ã—ã€ã‚ãã¾ã§Juliaã®ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã®å®Ÿè£…ã‚’è¿½ã†è¨˜äº‹ãªã®ã§ã€ãã®ã‚‚ã®ã«ã¤ã„ã¦ã¯è§£èª¬ã—ã¾ã›ã‚“ã€‚
(ã¤ã¾ã‚Šã€Juliaã¨ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã®åŸºç¤ã®åŸºç¤ãŒã‚ã‹ã£ã¦ã„ã‚‹ã“ã¨ãŒå‰æã¨ãªã£ã¦ã„ã¾ã™ã€‚)


**ã¾ãŸã€è¨˜äº‹ã®ä½œæˆã«ã‚ãŸã£ã¦ã¯ãªã‚‹ã¹ãæ­£ç¢ºã‚’æœŸã™ã‚‹ã‚ˆã†åŠªåŠ›ã—ã¦ã„ã¾ã™ãŒã€ã‚‚ã—é–“é•ã„ãŒã‚ã‚‹å ´åˆã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã—ã¦ã„ãŸã ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚**
ç‰¹ã«ã‚³ã‚¢ãªéƒ¨åˆ†ã®è©±ã‚„ç¿»è¨³ã«ã¤ã„ã¦ã¯ã‚ã¾ã‚Šè‡ªä¿¡ãŒãªã„ã®ã§ã€å„ªã—ã„ãƒã‚µã‚«ãƒªã‚’ãŠå¾…ã¡ã—ã¦ã„ã¾ã™ã€‚

## å‰æ

ç’°å¢ƒã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

```
Julia Version 1.5.2
Commit 539f3ce943 (2020-09-23 23:17 UTC)
Platform Info:
  OS: macOS (x86_64-apple-darwin18.7.0)
  CPU: Intel(R) Core(TM) i5-8259U CPU @ 2.30GHz
  WORD_SIZE: 64
  LIBM: libopenlibm
  LLVM: libLLVM-9.0.1 (ORCJIT, skylake)
```

:::message
Juliaã§ã¯ã€`versioninfo()`ã§ç¾åœ¨ã®ç’°å¢ƒã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚
:::

ã¾ãŸã€ `A .+ B`ã«ã¤ã„ã¦ã€å…·ä½“çš„ã«ã¯ã“ã‚Œã‚‰ã‚’æŒ‡ã—ã¾ã™ã€‚(ã‚ãã¾ã§å…·ä½“çš„ãªå€¤ã‚’æ‰±ã£ãŸæ–¹ãŒã‚ã‹ã‚Šã‚„ã™ã„ã€ã¨ã„ã†è¶£æ—¨ãªã®ã§ã“ã‚Œè‡ªä½“ã«æ„å‘³ã¯ã‚ã‚Šã¾ã›ã‚“)

```julia
julia> A = [1 2 3
           4 5 6
           7 8 9]
3Ã—3 Array{Int64,2}:
 1  2  3
 4  5  6
 7  8  9

julia> B = [1 2 3]
1Ã—3 Array{Int64,2}:
 1  2  3

julia> A .+ B
3Ã—3 Array{Int64,2}:
 2   4   6
 5   7   9
 8  10  12

```




# ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ

ã•ã¦ã€ã‚¿ã‚¤ãƒˆãƒ«ã«ãªã£ã¦ã„ã‚‹ 
`A .+ B` ã«ã¤ã„ã¦ã€€å°‘ã—è§£èª¬ã—ã¾ã™ã€‚

ã“ã‚Œã¯ã€ã€Œãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã€ã¨å‘¼ã°ã‚Œã‚‹æ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã¨ã¯ã€å¤šæ¬¡å…ƒé…åˆ—ã©ã†ã—ã®æ¼”ç®—ãªã©ã«ç”¨ã„ã‚‰ã‚Œã‚‹æ©Ÿèƒ½ã§ã€ã“ã‚Œã‚’åˆ©ç”¨ã—ã¦ç°¡æ½”ãªè¨˜è¿°ãŒå¯èƒ½ã§ã™ã€‚(è©³ã—ãã¯ã€[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.julialang.org/en/v1/manual/arrays/#Broadcasting)ã‚’å‚ç…§ã—ã¦ãã ã•ã„)

ä»–ã®è¨€èªã§ã‚‚å¤šãå®Ÿè£…ã•ã‚Œã¦ã„ã¦ã€ç‰¹ã«NumpyãŒæœ‰åã§ã™ã€‚

Juliaã§ã¯é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã¨ãã«ã€ãã®é–¢æ•°åã®æœ«å°¾ã« `.` ã‚’ã¤ã‘ã‚‹ã“ã¨ã§ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚’åˆ©ç”¨ã§ãã¾ã™ã€‚

```julia
# broadcastã®ä¾‹

julia> f(x) = 2x
f (generic function with 1 method)

julia> arr = [2, 4, 5]
3-element Array{Int64,1}:
 2
 4
 5

julia> f.(arr)
3-element Array{Int64,1}:
  4
  8
 10
```

ã¾ãŸã€æ¼”ç®—å­ã«å¯¾ã—ã¦ã¯`A .op B`ã®ã‚ˆã†ãªè¨˜æ³•ã§ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆãŒåˆ©ç”¨å¯èƒ½ã§ã™ã€‚(è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼)

:::details [è£œè¶³]:æ¼”ç®—å­ã«ã¤ã„ã¦
Juliaã§ã¯ã€æ§˜ã€…ãªç®—è¡“æ¼”ç®—å­ã‚’æ‰±ãˆã¾ã™ã€‚
ãŸã ã—ã“ã‚Œã‚‰ã¯å˜ã«ç‰¹æ®Šãªè¨˜æ³•ãŒå¯èƒ½ã¨ã„ã†ã ã‘ã§ã€é€šå¸¸ã®Juliaã®é–¢æ•°ã¨å¤‰ã‚ã‚Šã‚ã‚Šã¾ã›ã‚“ã€‚
ãªã®ã§
```julia
julia> +(4, 5)
9
```
ã®ã‚ˆã†ã«é€šå¸¸ã®ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—ã®è¨˜æ³•ãŒä½¿ãˆã¾ã™ã—ã€
**é–¢æ•°ã¯ç¬¬ä¸€ç´šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãªã®ã§ã€å¼•æ•°ã¨ã—ã¦ã‚‚ä½¿ãˆã¾ã™ã€‚**
æ¼”ç®—å­ã®ã‚ˆã†ãªè¨˜æ³•(infix notation)ãŒä½¿ãˆã‚‹é–¢æ•°åã«ã¤ã„ã¦ã¯ã€[Schemeè£½ã®Juliaã®ãƒ‘ãƒ¼ã‚µã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰](https://github.com/JuliaLang/julia/blob/master/src/julia-parser.scm)ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚
(ã¨ã¯è¨€ãˆã€çªç„¶è¬ã®æ¼”ç®—å­ãŒç™»å ´ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§ã¯æœ€æ‚ªã§ã™ãŒ....)
:::

:::message
ã“ã®è¨˜äº‹ã§ã¯ã€`+`, `-`, `*`, `/` ãªã©ã®`A + B`ã®ã‚ˆã†ãªè¨˜æ³•(infix notation)ãŒå¯èƒ½ãªé–¢æ•°ã‚’æ¼”ç®—å­ã¨å‘¼ã³ã¾ã™ã€‚
:::

# ã‚³ãƒ¼ãƒ‰ã‚’è¿½ã†

## ç¬¬ä¸€æ®µéš

ã¨ã“ã‚ã§ã€Juliaã®ã‚³ãƒ¼ãƒ‰ã¯ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚Œã‚‹æ™‚ã€ã„ãã¤ã‹ã®æ®µéšã‚’çµŒã¦æ©Ÿæ¢°èªã¸ã¨ç¿»è¨³ã•ã‚Œã¾ã™ã€‚
å…·ä½“çš„ã«ã¯ã€
ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ -> ä½ãƒ¬ãƒ™ãƒ«è¡¨ç¾ -> å‹ä»˜è¡¨ç¾ -> LLVMä¸­é–“è¡¨ç¾ -> ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰
ã¨ã„ã†é †ã§ã™ã€‚
ãã—ã¦ã€ãã®æ®µéšã§ã®è¡¨ç¾ã¯ã€ãã‚Œãã‚Œ

- @code_lowerd(ä½ãƒ¬ãƒ™ãƒ«è¡¨ç¾),
- @code_typed(å‹ä»˜è¡¨ç¾)
- @code_llvm(LLVMä¸­é–“è¡¨ç¾)
- @code_native(ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰)
 
ã§ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã§ã¯æ—©é€Ÿä½¿ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```
julia> f() = A .+ B
f (generic function with 2 methods)

julia> @code_lowered f()
CodeInfo(
1 â”€ %1 = Base.broadcasted(Main.:+, Main.A, Main.B)
â”‚   %2 = Base.materialize(%1)
â””â”€â”€      return %2
)
```

:::message alert
ã“ã“ã§ã‚ã–ã‚ã–é–¢æ•°ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ãŒã€ã“ã‚Œã¯ãã®ã¾ã¾ A .+ Bã¨ã™ã‚‹ã¨ä½•æ•…ã‹ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ãŸã‚ã§ã™ã€‚***Julia Master*** ã®æ–¹ã¯ã©ã†ã—ã¦ãã†ãªã‚‹ã®ã‹æ•™ãˆã¦ãã ã•ã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚
:::

ã•ã¦ã€f()ã¯ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã—ãŸæ¼”ç®—çµæœã‚’è¿”ã™ã ã‘ã§ã™ãŒã€ã©ã†ã‚„ã‚‰2å›ä½•ã‹ãŒè¨ˆç®—ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

æ—©é€Ÿãã‚Œã‚‰ã‚’è©³ã—ãã¿ã¦ã‚‚è‰¯ã„ã®ã§ã™ãŒã€ã²ã¨ã¾ãšç°¡å˜ã«2ã¤ã®é–¢æ•°ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚

Base.broadcastedã¯ã©ã†ã¿ã¦ã‚‚broadcastã‚’ã—ã¦ã„ã¾ã™ãŒã€Base.materializeã¯ä½•ã‚’ã—ã¦ã„ã‚‹ã‚“ã§ã—ã‚‡ã†ã€‚ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚

:::message
Juliaã®å¯¾è©±çš„ç’°å¢ƒã§ã¯ã€
`?hoge`ã§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
:::

```

help?> Base.materialize
  Broadcast.materialize(bc)

  Take a lazy Broadcasted object and compute the result

```

>Take a lazy Broadcasted object and compute the result
 
ãªã‚‹ã»ã©ã€ã©ã†ã‚„ã‚‰broadcastã¯å®Ÿéš›ã«ãã®å ´ã§é…åˆ—ã‚’è¤‡è£½ã—ãŸã‚Šã™ã‚‹ã®ã§ã¯ãªãã€é…å»¶è©•ä¾¡ã‚’è¡Œã†ã“ã¨ã§é«˜é€Ÿã«å‹•ä½œã™ã‚‹ã‚ˆã†ã§ã™ã­ï¼
ã“ã‚Œã¯ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚€ã“ã¨ã§ã„ã‚ã„ã‚ãªçŸ¥è¦‹ãŒå¾—ã‚‰ã‚Œãã†ã§ã™ã€‚

ãã‚Œã§ã¯`Base.broadcasted`ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ï¼


## Base.broadcasted

ã§ã¯æ—©é€Ÿ`?Base.broadcasted`ã‚’å®Ÿè¡Œã—ã¦ã¿ã¦ãã ã•ã„^^

:::details å–æç­ã‚’è¥²ã£ãŸæ‚²åŠ‡
```
help?> Base.broadcasted
  No documentation found.

  Base.Broadcast.broadcasted is a Function.

  # 53 methods for generic function "broadcasted":
  [1] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(+), r::AbstractUnitRange, x::Real) in Base.Broadcast at broadcast.jl:1038
  [2] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(+), r::OrdinalRange) in Base.Broadcast at broadcast.jl:1029
  [3] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(+), r::StepRangeLen) in Base.Broadcast at broadcast.jl:1030
  [4] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(+), r::LinRange) in Base.Broadcast at broadcast.jl:1031
  [5] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(+), x::Real, r::AbstractUnitRange) in Base.Broadcast at broadcast.jl:1037
  [6] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(+), r::StepRangeLen{T,R,S} where S where R, x::Number) where T in Base.Broadcast at broadcast.jl:1042
  [7] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(+), r::LinRange, x::Number) in Base.Broadcast at broadcast.jl:1046
  [8] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(+), r::AbstractRange, x::Number) in Base.Broadcast at broadcast.jl:1040
  [9] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(+), x::Number, r::StepRangeLen{T,R,S} where S where R) where T in Base.Broadcast at broadcast.jl:1044
  [10] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(+), x::Number, r::LinRange) in Base.Broadcast at broadcast.jl:1047
  [11] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(+), x::Number, r::AbstractRange) in Base.Broadcast at broadcast.jl:1041
  [12] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(+), r1::AbstractRange, r2::AbstractRange) in Base.Broadcast at broadcast.jl:1048
  [13] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(-), r::AbstractUnitRange, x::Number) in Base.Broadcast at broadcast.jl:1050
  [14] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(-), r::OrdinalRange) in Base.Broadcast at broadcast.jl:1033
  [15] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(-), r::StepRangeLen) in Base.Broadcast at broadcast.jl:1034
  [16] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(-), r::LinRange) in Base.Broadcast at broadcast.jl:1035
  [17] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(-), r::StepRangeLen{T,R,S} where S where R, x::Number) where T in Base.Broadcast at broadcast.jl:1053
  [18] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(-), r::LinRange, x::Number) in Base.Broadcast at broadcast.jl:1057
  [19] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(-), r::AbstractRange, x::Number) in Base.Broadcast at broadcast.jl:1051
  [20] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(-), x::Number, r::StepRangeLen{T,R,S} where S where R) where T in Base.Broadcast at broadcast.jl:1055
  [21] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(-), x::Number, r::LinRange) in Base.Broadcast at broadcast.jl:1058
  [22] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(-), x::Number, r::AbstractRange) in Base.Broadcast at broadcast.jl:1052
  [23] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(-), r1::AbstractRange, r2::AbstractRange) in Base.Broadcast at broadcast.jl:1059
  [24] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(*), x::Number, r::StepRangeLen{T,R,S} where S where R) where T in Base.Broadcast at broadcast.jl:1062
  [25] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(*), x::Number, r::LinRange) in Base.Broadcast at broadcast.jl:1064
  [26] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(*), x::Number, r::AbstractRange) in Base.Broadcast at broadcast.jl:1061
  [27] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(*), r::StepRangeLen{T,R,S} where S where R, x::Number) where T in Base.Broadcast at broadcast.jl:1067
  [28] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(*), r::LinRange, x::Number) in Base.Broadcast at broadcast.jl:1069
  [29] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(*), r::AbstractRange, x::Number) in Base.Broadcast at broadcast.jl:1066
  [30] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(/), r::StepRangeLen{T,R,S} where S where R, x::Number) where T in Base.Broadcast at broadcast.jl:1072
  [31] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(/), r::LinRange, x::Number) in Base.Broadcast at broadcast.jl:1074
  [32] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(/), r::AbstractRange, x::Number) in Base.Broadcast at broadcast.jl:1071
  [33] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(\), x::Number, r::StepRangeLen) in Base.Broadcast at broadcast.jl:1077
  [34] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(\), x::Number, r::LinRange) in Base.Broadcast at broadcast.jl:1078
  [35] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(\), x::Number, r::AbstractRange) in Base.Broadcast at broadcast.jl:1076
  [36] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(big), r::UnitRange) in Base.Broadcast at broadcast.jl:1080
  [37] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(big), r::StepRange) in Base.Broadcast at broadcast.jl:1081
  [38] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(big), r::StepRangeLen) in Base.Broadcast at broadcast.jl:1082
  [39] broadcasted(::Base.Broadcast.DefaultArrayStyle{1}, ::typeof(big), r::LinRange) in Base.Broadcast at broadcast.jl:1083
  [40] broadcasted(::typeof(+), I::CartesianIndices{N,R} where R<:Tuple{Vararg{AbstractUnitRange{Int64},N}}, j::CartesianIndex{N}) where N in Base.Broadcast at broadcast.jl:1086
  [41] broadcasted(::typeof(+), j::CartesianIndex{N}, I::CartesianIndices{N,R} where R<:Tuple{Vararg{AbstractUnitRange{Int64},N}}) where N in Base.Broadcast at broadcast.jl:1088
  [42] broadcasted(::typeof(-), I::CartesianIndices{N,R} where R<:Tuple{Vararg{AbstractUnitRange{Int64},N}}, j::CartesianIndex{N}) where N in Base.Broadcast at broadcast.jl:1090
  [43] broadcasted(::typeof(-), j::CartesianIndex{N}, I::CartesianIndices{N,R} where R<:Tuple{Vararg{AbstractUnitRange{Int64},N}}) where N in Base.Broadcast at broadcast.jl:1093
  [44] broadcasted(::typeof(LinearAlgebra.:*â‚›), out, beta) in LinearAlgebra at /Applications/Julia-1.4.app/Contents/Resources/julia/share/julia/stdlib/v1.4/LinearAlgebra/src/diagonal.jl:290
  [45] broadcasted(::typeof(*), x::Number, J::LinearAlgebra.UniformScaling) in LinearAlgebra at /Applications/Julia-1.4.app/Contents/Resources/julia/share/julia/stdlib/v1.4/LinearAlgebra/src/uniformscaling.jl:227
  [46] broadcasted(::typeof(*), J::LinearAlgebra.UniformScaling, x::Number) in LinearAlgebra at /Applications/Julia-1.4.app/Contents/Resources/julia/share/julia/stdlib/v1.4/LinearAlgebra/src/uniformscaling.jl:228
  [47] broadcasted(::typeof(/), J::LinearAlgebra.UniformScaling, x::Number) in LinearAlgebra at /Applications/Julia-1.4.app/Contents/Resources/julia/share/julia/stdlib/v1.4/LinearAlgebra/src/uniformscaling.jl:230
  [48] broadcasted(::typeof(^), J::LinearAlgebra.UniformScaling, x::Number) in LinearAlgebra at /Applications/Julia-1.4.app/Contents/Resources/julia/share/julia/stdlib/v1.4/LinearAlgebra/src/uniformscaling.jl:235
  [49] broadcasted(::typeof(Base.literal_pow), ::typeof(^), J::LinearAlgebra.UniformScaling, x::Val) in LinearAlgebra at /Applications/Julia-1.4.app/Contents/Resources/julia/share/julia/stdlib/v1.4/LinearAlgebra/src/uniformscaling.jl:237
  [50] broadcasted(::S, f, args...) where S<:Base.Broadcast.BroadcastStyle in Base.Broadcast at broadcast.jl:1240
  [51] broadcasted(f, arg1, arg2, args...) in Base.Broadcast at broadcast.jl:1235
  [52] broadcasted(f, arg1, args...) in Base.Broadcast at broadcast.jl:1230
  [53] broadcasted(f, args...) in Base.Broadcast at broadcast.jl:1222
```
:::


ã“ã‚Œã®ã›ã„ã§markdownãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã«ãããªã‚Šã¾ã—ãŸã€‚Juliaè¨€èªã‚’è¨±ã•ãªã„ã€‚

ã•ã¦ã€ã“ã®ã‚ˆã†ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã‚‚ãã®é–¢æ•°ãŒã‚ˆãã‚ã‹ã‚‰ãªã„æ™‚ã¯ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿ã«ã„ãã¾ã—ã‚‡ã†ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼

ãã‚“ãªæ™‚ã®ãŸã‚ã«Juliaã¯ä¾¿åˆ©ãªãƒã‚¯ãƒ­ã‚’æ¨™æº–ã§æ­è¼‰ã—ã¦ã„ã¾ã™ã€‚

```
julia> @functionloc Base.broadcasted(Main.:+, Main.A, Main.B)
("/path/to/julia/bin/../share/julia/base/broadcast.jl", 1235)
```

@functionlocã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€å‘¼ã³å‡ºã•ã‚ŒãŸé–¢æ•°ãŒã©ã“ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã®ã‹ç¢ºèªã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¨ã„ã†ã‚ã‘ã§ã€base/broadcast.jlã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

Juliaã¯å¤§å­¦ã¨ã‹ã§ã‚„ãŸã‚‰ä½¿ã‚ã‚Œã¦ã„ã‚‹æŸè¨€èªãªã©ã¨é•ã£ã¦ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãªã®ã§ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¯GitHubã§ç¢ºèªã§ãã¾ã™ã€‚(ãŒã€Juliaã¯ã©ã‚“ã©ã‚“æ”¹å–„ã•ã‚Œã¦ã„ãã®ã§ã€ç´ ç›´ã«æ‰‹å…ƒã«ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ç¢ºèªã—ãŸæ–¹ãŒè‰¯ã„ã§ã™ã€‚è©²å½“ã™ã‚‹ãƒ–ãƒ©ãƒ³ãƒã‚’æ¢ã™ã®ã‚‚é¢å€’ã§ã™ã—, ã‚¨ãƒ‡ã‚£ã‚¿ã®æ©Ÿèƒ½ã‚’è‰²ã€…ä½¿ãˆã¦ä¾¿åˆ©ã§ã™ã€‚
broadcast.jlã¯ã€ `/path/to/Julia-1.5/Contents/Resources/julia/share/julia/base ã«ã‚ã‚Šã¾ã™ã€‚

ã•ã¦ã€1259è¡Œç›®ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

```julia
@inline function broadcasted(f, arg1, arg2, args...)
    arg1â€² = broadcastable(arg1)
    arg2â€² = broadcastable(arg2)
    argsâ€² = map(broadcastable, args)
    broadcasted(combine_styles(arg1â€², arg2â€², argsâ€²...), f, arg1â€², arg2â€², argsâ€²...)
end
```


ã“ã‚Œã‚’ç´ ç›´ã«ã‚°ãƒ©ãƒ•ã«ã™ã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/i8bgv2ystdt27lqmvtxuq2l2lnpz)

ã“ã‚Œã«ã©ã‚“ã©ã‚“æƒ…å ±ã‚’ä»˜ã‘è¶³ã—ã¦å®Œæˆã‚’ç›®æŒ‡ã—ã¾ã™ã€‚

ã•ã¦ã€broadcastedã®ä¸­ã§broadcastedãŒå‘¼ã°ã‚Œã¦ã„ã‚‹ã“ã¨ã«ãŠæ°—ã¥ãã§ã—ã‚‡ã†ã‹ï¼Ÿ
ä»–ã®è¨€èªã‚’ä½¿ã£ã¦ã„ã‚‹æ–¹ã ã¨(ã“ã®è¨˜äº‹ã‚’èª­ã‚“ã§ã„ã‚‹æ–¹ã«ã„ã‚‹ã‹ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ãŒ...)

ã€Œãˆï¼Ÿå†å¸°ãªã®ã«ãƒ™ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ãªããªã„ï¼Ÿã“ã‚Œç„¡é™ãƒ«ãƒ¼ãƒ—ã§ã¯.....ï¼Ÿã€

ã¨ãªã£ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚
ã—ã‹ã—æœ€å¾Œã®è¡Œã§å‘¼ã°ã‚Œã‚‹`broadcasted`ã¯ã€åŒã˜é–¢æ•°ã§ã™ãŒåˆ¥ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ã€‚Juliaã§ã¯ã€ã€Œå¤šé‡ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã€ã¨ã„ã†ä»•çµ„ã¿ã«ã‚ˆã£ã¦ã€å‹•çš„ã«ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚

ã“ã®å¤šé‡ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã‚’ç”¨ã„ã‚‹ã“ã¨ã§ã€æ•°å­¦çš„ã«è‡ªç„¶ãªè€ƒãˆæ–¹ã§æŸ”è»Ÿãªè¨­è¨ˆãŒå¯èƒ½ã§ã™ã€‚(ã—ã‹ã‚‚ã“ã®å‹•çš„ãªãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã¯ã»ã¨ã‚“ã©ã‚¼ãƒ­ã‚³ã‚¹ãƒˆã§ã™ï¼Juliaã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ä¸‡æ­³ï¼)


:::details å¤šé‡ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã®ç°¡å˜ãªä¾‹
```julia
julia> double(x::Int) = 2x
double (generic function with 1 method)

julia> double(x::String) = x * x  # Juliaã®æ–‡å­—åˆ—çµåˆã¯ * ã§ã™
double (generic function with 2 methods)

julia> double(10)
20

julia> double("JuliaLang")
"JuliaLangJuliaLang"
```
:::

ã•ã¦ã€ã§ã¯å®Ÿéš›ã«é–¢æ•°ã®ä¸­èº«ã‚’è¦‹ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚

### broadcastable
ã¾ãšã¯1~3è¡Œç›®ã§ã™ã€‚
å¼•æ•°ã‚’é †ç•ªã«`broadcastable`ã«æ¸¡ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚
3å¼•æ•°ç›®ã¾ã§ã¯é †ç•ªã«ã€ãã‚Œä»¥é™ã¯`map`ã«æ¸¡ã—ã¦ã„ã‚‹ã®ãŒã‚ˆãã‚ã‹ã‚‰ãªã„ã§ã™ã­...
ã»ã¨ã‚“ã©ã®å ´åˆã€å¼•æ•°ã¯2å€‹ã§ã™ã‹ã‚‰ã€(ã‚€ã—ã‚3å€‹ä»¥ä¸Šã®å ´åˆãŒæ€ã„ã¤ã‹ãªã„) `map`ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’æ°—ã«ã—ã¦ã„ã‚‹ã‚“ã§ã—ã‚‡ã†ã‹ã€‚

ã¾ãšã¯`broadcastable`ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

Broadcast.broadcastable
```julia
  Broadcast.broadcastable(x)

  Return either x or an object like x such that it supports axes, indexing, and its type supports ndims.
  # è»¸ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã€æ¬¡å…ƒæ•°ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‚ˆã†ãªx(ã‚‚ã—ãã¯xã®ã‚ˆã†ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ)ã‚’è¿”ã—ã¾ã™ã€‚
  If x supports iteration, the returned value should have the same axes and indexing behaviors as collect(x).
  # ã‚‚ã—xãŒiterationã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹å ´åˆã¯ã€è¿”ã‚Šå€¤ã¯collect(x)ã®
  If x is not an AbstractArray but it supports axes, indexing, and its type supports ndims, then broadcastable(::typeof(x)) may be
  implemented to just return itself. Further, if x defines its own BroadcastStyle, then it must define its broadcastable method to
  return itself for the custom style to have any effect.

  Examples
  â‰¡â‰¡â‰¡â‰¡â‰¡â‰¡â‰¡â‰¡â‰¡â‰¡

  julia> Broadcast.broadcastable([1,2,3]) # like `identity` since arrays already support axes and indexing
  3-element Array{Int64,1}:
   1
   2
   3
  
  julia> Broadcast.broadcastable(Int) # Types don't support axes, indexing, or iteration but are commonly used as scalars
  Base.RefValue{Type{Int64}}(Int64)
  
  julia> Broadcast.broadcastable("hello") # Strings break convention of matching iteration and act like a scalar instead
  Base.RefValue{String}("hello")
```

:::

`broadcastable`ã¯å¼•æ•°ã‚’æ¬¡å…ƒã‚„è»¸ã‚’æŒã¤å½¢ã«å¤‰å½¢ã—ã¾ã™ã€‚ä»Šå›ã¯Aã‚‚Bã‚‚é…åˆ—ãªã®ã§ã€å¤‰åŒ–ã¯èµ·ããªã„ã§ã™ã­ã€‚



```julia
julia> Broadcast.broadcastable(A) == A
true

julia> Broadcast.broadcastable(B) == B
true
```

ã“ã‚Œã‚’ã‚°ãƒ©ãƒ•ã«è¿½è¨˜ã—ã¦ãŠãã¾ã™ã€‚(è¿”ã‚Šå€¤ã®å‹ã‚’ã‚°ãƒ©ãƒ•ã®ã‚¨ãƒƒã‚¸ã«æ›¸ãã“ã¨ã«ã—ã¾ã™)

![](https://storage.googleapis.com/zenn-user-upload/u03iel4vdn3rrvhf0yofes65w9o8)


### combine_styles


æ¬¡ã«`combine_styles`ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚

:::details combine_styles
```julia
help?> Broadcast.combine_styles
  combine_styles(cs...) -> BroadcastStyle

  Decides which BroadcastStyle to use for any number of value arguments. Uses BroadcastStyle to get the style for each argument,
  and uses result_style to combine styles.

  Examples
  â‰¡â‰¡â‰¡â‰¡â‰¡â‰¡â‰¡â‰¡â‰¡â‰¡

  julia> Broadcast.combine_styles([1], [1 2; 3 4])
  Base.Broadcast.DefaultArrayStyle{2}()
```
:::


`BroadcastStyle`ã‚’è¿”ã™é–¢æ•°ã§ã™ã€‚
ãã‚‚ãã‚‚`BroadcastStyle`ã¨ã¯ä½•ã‹ã€ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚

BroadcastStyle

```julia
help?> Broadcast.BroadcastStyle
  BroadcastStyle is an abstract type and trait-function used to determine behavior of objects under broadcasting.
# `BroadcastStyle`ã¯abstract typeã§ã‚ã‚Šã€ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã•ã‚Œã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æŒ¯ã‚‹èˆã„ã‚’æ±ºå®šã™ã‚‹ãŸã‚ã®trait-functionã§ã™ã€‚
  BroadcastStyle(typeof(x)) returns the style associated with x. To customize the broadcasting behavior of a type, one can declare
  a style by defining a type/method pair
# BroadcastStyle(typeof(x))ã¯xã«é–¢é€£ä»˜ã‘ã‚‰ã‚ŒãŸã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿”ã—ã¾ã™ã€‚å‹ã®ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆå‹•ä½œã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ãŸã‚ã«ã€å‹ã¨ãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒšã‚¢ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã§ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å®£è¨€ã§ãã¾ã™ã€‚
  struct MyContainerStyle <: BroadcastStyle end
  Base.BroadcastStyle(::Type{<:MyContainer}) = MyContainerStyle()

  One then writes method(s) (at least similar) operating on Broadcasted{MyContainerStyle}. There are also several pre-defined
  subtypes of BroadcastStyle that you may be able to leverage; see the Interfaces chapter for more information.

  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  BroadcastStyle(::Style1, ::Style2) = Style3()

  Indicate how to resolve different BroadcastStyles. For example,

  BroadcastStyle(::Primary, ::Secondary) = Primary()

  would indicate that style Primary has precedence over Secondary. You do not have to (and generally should not) define both
  argument orders. The result does not have to be one of the input arguments, it could be a third type.

  Please see the Interfaces chapter of the manual for more information.
```







:::details [è£œè¶³]:abstract typeã«ã¤ã„ã¦
Juliaã¯å‹•çš„å‹ä»˜ã‘ã®è¨€èªã§ã™ãŒã€é™çš„å‹ä»˜ã‘ã®ã‚·ã‚¹ãƒ†ãƒ ã®åˆ©ç‚¹ã‚’ã‚ã‚‹ç¨‹åº¦å–ã‚Šå…¥ã‚Œã¦åŠ¹ç‡çš„ãªã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™ã€‚
Juliaã®å‹ã«ã¯å¤§åˆ¥ã—ã¦abstract type, concrete typeã®äºŒç¨®é¡ãŒã‚ã‚Šã¾ã™ã€‚(å‰è€…ã¯æŠ½è±¡å‹ã€å¾Œè€…ã¯å…·ä½“å‹ã€ã‚‚ã—ãã¯å…·è±¡å‹ã¨è¨³ã•ã‚Œã¾ã™)
ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå®Ÿéš›ã«æŒã¤å‹ãŒå…·ä½“å‹ã§ã€(ä¾‹:Int64, String)
å…¨ã¦ã®å…·ä½“å‹ã¯æŠ½è±¡å‹ã‚’è¦ª(supertype)ã«æŒã¡ã¾ã™ã€‚(ä¾‹:Int64ã®è¦ªã‚¿ã‚¤ãƒ—ã¯Signed(ç¬¦å·ä»˜ãæ•´æ•°))
ã¤ã¾ã‚ŠJuliaã¯æ¬¡ã®ã‚ˆã†ã«ãã‚Œãã‚Œã®å‹ãŒéšå±¤é–¢ä¿‚ã‚’æŒã¡ã€å…¨ã¦ã®å‹ã¯Anyã®å­ã§ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/ne8vtmy4j80n7uakbldqasm2wo75)[^1]
[^1]:https://www.sas.upenn.edu/~jesusfv/Chapter_HPC_8_Julia.pdf

ã¡ãªã¿ã«ã‚ã‚‹æŠ½è±¡å‹ã®å­ã¯`subtypes(Hoge)`,ã¾ãŸå…·ä½“å‹ã®è¦ªã¯`supertype(Huga)`ã§ç¢ºèªã§ãã¾ã™ã€‚
ã¾ãŸã€AãŒBã®å­ã«å½“ãŸã‚‹ã‹ã©ã†ã‹ã¯ã€ `A <: B`ã§åˆ¤å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

:::


# trait-functionã«ã¤ã„ã¦
trait-functionã¨ã¯ã€Holy traitã¨å‘¼ã°ã‚Œã‚‹è¨­è¨ˆæ‰‹æ³•ã§ç”¨ã„ã‚‰ã‚Œã‚‹é–¢æ•°ã§ã™ã€‚
Holy-traitã«ã¤ã„ã¦ç°¡å˜ã«èª¬æ˜ã—ã¦ã¿ã¾ã™ã€‚[^2]
[^2]:ã“ã¡ã‚‰ã®è¨˜äº‹ã‚’å…ƒã«ã—ã¦èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚(https://qiita.com/tenfu2tea/items/09c3528b2144d1eac74a)

æ¬¡ã®ã‚ˆã†ãªé–¢æ•°ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ã‚’è€ƒãˆã¦ã¿ã¾ã™ã€‚(ã‚ãã¾ã§ä¾‹ã§ãªã®ã§ã€ã‚ˆã‚ŠåŠ¹ç‡çš„ãªå®Ÿè£…ãªã©ãŒã‚ã‚Šã¾ã™ãŒã€ã‚³ãƒ¼ãƒ‰ã®å†…å®¹ã«ã¤ã„ã¦ã¯ã‚ã¾ã‚Šçªã£è¾¼ã¾ãªã„ã§ãã ã•ã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚)

- å¼•æ•°ãŒã‚¿ãƒ—ãƒ«ã‚„ãƒ™ã‚¯ãƒˆãƒ«ï¼ˆï¼‘æ¬¡å…ƒé…åˆ—ï¼‰ãªã‚‰ã€ãã‚Œè‡ªèº«ã‚’è¿”ã™ã€‚
- å¼•æ•°ãŒæ•°ï¼ˆã‚¹ã‚«ãƒ©ãƒ¼ï¼‰ãªã‚‰ã€1ã¤ã®è¦ç´ ã®ãƒ™ã‚¯ãƒˆãƒ«ã‚’ä½œã£ã¦è¿”ã™ã€‚

(ã¤ã¾ã‚Šã¯ã€å¼•æ•°ã‚’ç¹°ã‚Šè¿”ã—å¯èƒ½ã«ã™ã‚‹é–¢æ•°ã§ã™ï¼)


ã•ã¦ã€ã“ã‚Œã‚’**ã¨ã¦ã‚‚ç´ ç›´ã«**å®Ÿè£…ã™ã‚‹ã¨æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```julia
# var isa Hoge ã¯ã€ typeof(var) <: Hogeã¨ç­‰ä¾¡ã§ã™ã€‚
julia> function aslist(var)
           if var isa Number 
               return [var,]
           elseif var isa Tuple || var isa Vector
               return var
           end
       end
aslist (generic function with 1 method)

julia> aslist(10)
1-element Array{Int64,1}:
 10

julia> aslist([1, 2, 3])
3-element Array{Int64,1}:
 1
 2
 3

julia> aslist((1, 2, 3))
(1, 2, 3)
```

ã§ã™ãŒã“ã‚Œã¯ã¨ã¦ã‚‚æ‚ªã„ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚
Juliaã§ã¯å¤šé‡ãƒ‡ã‚£ã‚¹ãƒ‘ãƒƒãƒã‚’ç”¨ã„ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ã‹ã‚Œã‚‹ã¹ãã§ã™ã€‚

```julia
julia> aslist(x::Int) = [x, ] 
aslist (generic function with 2 methods)

julia> aslist(arr::Vector) = arr
aslist (generic function with 3 methods)

julia> aslist(t::Tuple) = t
aslist (generic function with 4 methods)
```

ã¨ã“ã‚ã§ã€ã“ã®ã¨ãå¼•æ•°ãŒ`Vector`, `Tuple`ã®ã¨ãã¯åŒã˜å‡¦ç†ã‚’ã—ã¦ã„ã‚‹ã®ã§ã€ã“ã‚Œã‚’ã¾ã¨ã‚ãŸããªã‚Šã¾ã™ã­ã€‚
ãã®ã¨ãã¯ã€`Union` å‹ã‚’ç”¨ã„ã‚‹ã¨ä¾¿åˆ©ã§ã™ã€‚
`Union`å‹ã¯ã€ç‰¹æ®Šãªabstract typeã®ä¸€ç¨®ã§ã€è¤‡æ•°ã®å‹ã®å’Œé›†åˆã‚’è¡¨ã—ã¾ã™ã€‚

ä¾‹ãˆã°ã€`Int`ã¨`String`ã‚’ã¾ã¨ã‚ãŸå‹ã¯ã€

```julia
julia> IntOrString = Union{Int, String}
Union{Int64, String}
```

ã¨å®£è¨€ã§ãã¾ã™ã€‚

ã—ãŸãŒã£ã¦

```julia
julia> Int <: IntOrString
true

julia> String <: IntOrString
true
```

ãªã®ã§ã€æ¬¡ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚


```julia
julia> f(x::IntOrString) = println("nice")
f (generic function with 2 methods)

julia> f(1)
nice

julia> f("Hi")
nice

julia> f([1, 2, 3])
ERROR: MethodError: no method matching f(::Array{Int64,1})
Closest candidates are:
  f() at REPL[4]:1
  f(::Union{Int64, String}) at REPL[37]:1
Stacktrace:
 [1] top-level scope at REPL[40]:1
```

æ—©é€Ÿã“ã‚Œã‚’å¿œç”¨ã—ã¦å…ˆã»ã©ã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãç›´ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```julia
julia> aslist(x::Int) = [x, ]
aslist (generic function with 4 methods)

julia> aslist(A::Union{Vector, Tuple}) = A
aslist (generic function with 5 methods)

julia> aslist(2)
1-element Array{Int64,1}:
 2

julia> aslist([1, 2, 3])
3-element Array{Int64,1}:
 1
 2
 3

julia> aslist((1, 2, 3))
(1, 2, 3)
```

ã“ã‚Œã§åŒã˜å‡¦ç†ã‚’ã¾ã¨ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

ã•ã¦ã€å…¥åŠ›ã§`Int`, `Vector`, `Tuple`ã®ã¿ã‚’æƒ³å®šã™ã‚‹å ´åˆã¯å•é¡Œãªãå‹•ä½œã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸãŒã€è¤‡ç´ æ•°ã‚„å¤šæ¬¡å…ƒé…åˆ—ãªã©ã®ä»–ã®å‹ã®å ´åˆã‚‚æƒ³å®šã—ãŸããªã£ãŸå ´åˆã¯ã©ã®ã‚ˆã†ã«ã™ã‚Œã°ã„ã„ã§ã—ã‚‡ã†ã‹ã€‚
æœ€ã‚‚ç°¡å˜ãªè§£æ±ºç­–ã¯ã€å…ˆã»ã©ã®`Union`å‹ã®å®šç¾©éƒ¨åˆ†ã«è¿½åŠ ã™ã‚‹ã“ã¨ã§ã™ã€‚

ã—ã‹ã—ã€ã“ã®æ–¹æ³•ã‚’ç”¨ã„ã‚‹ã¨ã€ã‚ã‚‹å‹ãŒã©ã®ãƒ¡ã‚½ãƒƒãƒ‰ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ã®ã‹ã€å¾Œã‹ã‚‰ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚€äººã«ã¨ã£ã¦ã‚ã‹ã‚Šã«ãããªã£ã¦ã—ã¾ã„ã¾ã™ã€‚(Unionå‹ã‚’ã„ã¡ã„ã¡è¦‹ã‚‹ã®ã¯ç›®ãŒç—›ããªã‚Šã¾ã™)
ãã‚Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«ç™»å ´ã™ã‚‹ã®ãŒ`trait type`ã¨ã€`trait function`ã§ã™ã€‚

ä¸€åº¦æ•´ç†ã™ã‚‹ã¨ã€ã“ã®é–¢æ•°ã¯ç¾åœ¨2ã¤ã®æŒ™å‹•ã‚’æŒã£ã¦ã„ã¾ã™ã€‚

- ãƒªã‚¹ãƒˆã®ã‚ˆã†ãªæŒ™å‹•
- ãã‚Œä»¥å¤–ã®æŒ™å‹•

ãã“ã§ã€æ¬¡ã®ã‚ˆã†ãªæŒ™å‹•ã«å¯¾å¿œã—ãŸå‹ã‚’ç”¨æ„ã—ã¾ã™ã€‚
ã“ã‚Œã¯*trait type*ã¨å‘¼ã°ã‚Œã¾ã™ã€‚

```julia
julia> struct List end

julia> struct NoList end
```

ã•ã‚‰ã«ã€ã“ã‚Œã‚‰ã®å‹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¿”ã™é–¢æ•°ã‚’æ›¸ãã¾ã™ã€‚
ã“ã‚Œã¯*trait function*ã¨å‘¼ã°ã‚Œã¾ã™ã€‚
```julia
julia> islist(::Vector) = List()
islist (generic function with 1 method)

julia> islist(::Tuple) = List()
islist (generic function with 2 methods)

julia> islist(::Int) = Nonlist()
islist (generic function with 3 methods)
```

ã™ã‚‹ã¨å•é¡Œã®é–¢æ•°ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ã‘ã¾ã™ã€‚

```julia
julia> aslist(x) = aslist(islist(x), x)
aslist (generic function with 5 methods)

julia> aslist(::List, x) = x
aslist (generic function with 6 methods)

julia> aslist(::NoList, x) = [x, ]
aslist (generic function with 7 methods)
```

å°‘ã—è¤‡é›‘ã«ãªã£ã¦ããŸã®ã§æ•´ç†ã—ã¾ã™ã€‚

ã¾ãšã€
`aslist(x)`ãŒå‘¼ã°ã‚Œã‚‹ã¨ã€ã“ã‚Œã¯1å¼•æ•°ãªã®ã§ã€`aslist(x) = aslist(islist(x), x)`ãŒå‘¼ã°ã‚Œã¾ã™ã€‚

ãã—ã¦`islist(x)`ã®è¿”ã‚Šå€¤ã«ã‚ˆã£ã¦ã€`aslist(::List, x) = x`ã‚‚ã—ãã¯`aslist(::NoList, x) = [x, ]`ãŒå‘¼ã°ã‚Œã¾ã™ã€‚
ã¡ãªã¿ã«ã€`aslist(::List, x) = x`ã¨`aslist(::NoList, x) = [x, ]`ã®ç¬¬ä¸€å¼•æ•°ã¯ã€ãã®å‹ã®ã¿ãŒå¿…è¦ã§ã‚ã‚Šã€ãã®å€¤ã¯å¿…è¦ãªã„ã®ã§ã€å¤‰æ•°åãŒçœç•¥ã•ã‚Œã¦ã„ã¾ã™ã€‚

ã•ã¦ã€ã“ã®ã‚ˆã†ãªæ›¸ãæ–¹ã‚’ç”¨ã„ã€trait functionã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€"ç°¡å˜ã«"ã€"å¯èª­æ€§ã‚’ä¿ã£ãŸã¾ã¾"ã€ã“ã®é–¢æ•°ã‚’ä»–ã®å‹ã«ã‚‚æ‹¡å¼µã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ã¾ãŸã€ã“ã®ã‚ˆã†ãªæ›¸ãæ–¹ã¯Juliaã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã«ã‚ˆã‚‹å¼·åŠ›ãªæœ€é©åŒ–ãŒåƒãã€ã»ã¨ã‚“ã©ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’æ°—ã«ã›ãšä½¿ãˆã¾ã™ã€‚(è©³ã—ãã¯å…ƒè¨˜äº‹ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼)

ã•ã¦ã€å‰ç½®ããŒé•·ããªã‚Šã¾ã—ãŸãŒã€å®Ÿéš›ã«combine_axisã‚’ç¢ºèªã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

